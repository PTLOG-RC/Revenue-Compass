<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PT LOG - Revenue Compass for Coaches</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { background: #111827; margin: 0; }
    * { box-sizing: border-box; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    input[type="date"] { min-height: 50px; }
    input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const SUPABASE_URL = 'https://wjaqbxxlnmcosnzzktza.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndqYXFieHhsbm1jb3NuenprdHphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MTc5NzAsImV4cCI6MjA4NzE5Mzk3MH0.HuHA43JsQEUu9KRO95uDTl83Rpj528bJJdBv5KI5rhI';
    
    // ==========================================
    // YOUR STRIPE PAYMENT LINKS - REPLACE THESE
    // ==========================================
    const STRIPE_LINKS = {
      monthly: 'https://buy.stripe.com/YOUR_MONTHLY_LINK',
      yearly: 'https://buy.stripe.com/YOUR_YEARLY_LINK',
      lifetime: 'https://buy.stripe.com/YOUR_LIFETIME_LINK'
    };
    // ==========================================
    
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const { useState, useEffect } = React;

    // Check if user just came from payment
    const urlParams = new URLSearchParams(window.location.search);
    const justPaid = urlParams.get('welcome') === 'true';

    // Paywall Component - Shows when user has no active subscription
    const Paywall = ({ email, onLogout, onRetry }) => {
      const [retrying, setRetrying] = useState(false);

      const handleRetry = async () => {
        setRetrying(true);
        await onRetry();
        setRetrying(false);
      };

      return (
        <div className="min-h-screen bg-gray-900 flex items-center justify-center p-4">
          <div className="fixed inset-0 bg-gradient-to-br from-gray-900 via-gray-900 to-gray-800 pointer-events-none" />
          <div className="fixed top-0 right-0 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl pointer-events-none" />
          <div className="fixed bottom-0 left-0 w-96 h-96 bg-emerald-500/10 rounded-full blur-3xl pointer-events-none" />
          
          <div className="relative max-w-4xl w-full">
            {/* Just paid message */}
            <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-2xl p-4 mb-6 text-center">
              <p className="text-yellow-400 font-medium">üéâ Just completed payment?</p>
              <p className="text-gray-400 text-sm mt-1">It may take up to 30 seconds to activate. Click below to check again.</p>
              <button 
                onClick={handleRetry} 
                disabled={retrying}
                className="mt-3 px-6 py-2 bg-yellow-500 hover:bg-yellow-400 disabled:bg-gray-600 text-gray-900 font-semibold rounded-xl text-sm"
              >
                {retrying ? 'Checking...' : 'Check My Subscription'}
              </button>
            </div>

            <div className="text-center mb-10">
              <h1 className="text-4xl font-bold text-white mb-4">Choose Your Plan</h1>
              <p className="text-gray-400 text-lg">Get full access to PT LOG and start tracking your revenue</p>
              <p className="text-gray-500 text-sm mt-2">Logged in as {email}</p>
            </div>

            <div className="grid md:grid-cols-3 gap-6 mb-8">
              <div className="bg-gray-800 border border-gray-700 rounded-2xl p-6 hover:border-cyan-500/50 transition-all">
                <div className="text-center">
                  <h3 className="text-lg font-semibold text-white mb-2">Monthly</h3>
                  <div className="text-4xl font-bold text-white mb-1">‚Ç¨9</div>
                  <div className="text-gray-400 text-sm mb-6">per month</div>
                  <ul className="text-left space-y-3 mb-6">
                    <li className="flex items-center text-gray-300 text-sm"><span className="text-emerald-400 mr-2">‚úì</span> All features included</li>
                    <li className="flex items-center text-gray-300 text-sm"><span className="text-emerald-400 mr-2">‚úì</span> Unlimited clients</li>
                    <li className="flex items-center text-gray-300 text-sm"><span className="text-emerald-400 mr-2">‚úì</span> Cancel anytime</li>
                  </ul>
                  <a href={STRIPE_LINKS.monthly} className="block w-full py-3 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-xl transition-colors text-center">Get Started</a>
                </div>
              </div>

              <div className="bg-gray-800 border-2 border-cyan-500 rounded-2xl p-6 relative transform md:-translate-y-2">
                <div className="absolute -top-3 left-1/2 -translate-x-1/2 bg-cyan-500 text-gray-900 text-xs font-bold px-4 py-1 rounded-full">BEST VALUE</div>
                <div className="text-center">
                  <h3 className="text-lg font-semibold text-white mb-2">Yearly</h3>
                  <div className="text-4xl font-bold text-white mb-1">‚Ç¨79</div>
                  <div className="text-gray-400 text-sm mb-1">per year</div>
                  <div className="text-emerald-400 text-sm font-medium mb-6">Save ‚Ç¨29 (3 months free!)</div>
                  <ul className="text-left space-y-3 mb-6">
                    <li className="flex items-center text-gray-300 text-sm"><span className="text-emerald-400 mr-2">‚úì</span> All features included</li>
                    <li className="flex items-center text-gray-300 text-sm"><span className="text-emerald-400 mr-2">‚úì</span> Unlimited clients</li>
                    <li className="flex items-center text-gray-300 text-sm"><span className="text-emerald-400 mr-2">‚úì</span> Priority support</li>
                  </ul>
                  <a href={STRIPE_LINKS.yearly} className="block w-full py-3 bg-cyan-500 hover:bg-cyan-400 text-gray-900 font-semibold rounded-xl transition-colors text-center">Get Started</a>
                </div>
              </div>

              <div className="bg-gray-800 border border-yellow-500/50 rounded-2xl p-6 hover:border-yellow-500 transition-all">
                <div className="text-center">
                  <h3 className="text-lg font-semibold text-white mb-2">Lifetime</h3>
                  <div className="text-4xl font-bold text-white mb-1">‚Ç¨149</div>
                  <div className="text-gray-400 text-sm mb-1">one-time payment</div>
                  <div className="text-orange-400 text-sm font-medium mb-6">üî• Only 50 spots!</div>
                  <ul className="text-left space-y-3 mb-6">
                    <li className="flex items-center text-gray-300 text-sm"><span className="text-emerald-400 mr-2">‚úì</span> All features forever</li>
                    <li className="flex items-center text-gray-300 text-sm"><span className="text-emerald-400 mr-2">‚úì</span> All future updates</li>
                    <li className="flex items-center text-gray-300 text-sm"><span className="text-emerald-400 mr-2">‚úì</span> Never pay again</li>
                  </ul>
                  <a href={STRIPE_LINKS.lifetime} className="block w-full py-3 bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-semibold rounded-xl transition-colors text-center">Get Lifetime Access</a>
                </div>
              </div>
            </div>

            <div className="text-center">
              <button onClick={onLogout} className="text-gray-500 hover:text-gray-300 text-sm">Logout</button>
            </div>
          </div>
        </div>
      );
    };

    const Modal = ({ title, children, onClose }) => (
      <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50" onClick={onClose}>
        <div className="bg-gray-800 border border-gray-700 rounded-2xl p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-xl font-semibold text-white">{title}</h3>
            <button onClick={onClose} className="text-gray-400 hover:text-white text-xl">‚úï</button>
          </div>
          {children}
        </div>
      </div>
    );

    const MetricCard = ({ icon, value, label, trend, color }) => (
      <div className="bg-gray-800/50 backdrop-blur border border-gray-700/50 rounded-2xl p-5 hover:border-gray-600 transition-all">
        <div className="flex items-start justify-between">
          <div className={`w-12 h-12 rounded-xl ${color} flex items-center justify-center text-2xl`}>{icon}</div>
          {trend !== undefined && trend !== null && (
            <span className={`text-xs px-2 py-1 rounded-full ${trend >= 0 ? 'bg-emerald-500/20 text-emerald-400' : 'bg-red-500/20 text-red-400'}`}>
              {trend >= 0 ? '‚Üë' : '‚Üì'} {Math.abs(trend)}%
            </span>
          )}
        </div>
        <div className="mt-4">
          <div className="text-3xl font-bold text-white">{value}</div>
          <div className="text-gray-400 text-sm mt-1">{label}</div>
        </div>
      </div>
    );

    const ProgressBar = ({ current, goal, label, color = "from-cyan-500 to-cyan-400" }) => {
      const percentage = goal > 0 ? Math.min((current / goal) * 100, 100) : 0;
      return (
        <div className="mb-4">
          <div className="flex justify-between mb-2">
            <span className="text-gray-300 text-sm font-medium">{label}</span>
            <span className="text-white text-sm font-semibold">{current.toLocaleString()} / {goal.toLocaleString()}</span>
          </div>
          <div className="h-3 bg-gray-700 rounded-full overflow-hidden">
            <div className={`h-full rounded-full bg-gradient-to-r ${color} transition-all duration-700`} style={{ width: `${percentage}%` }} />
          </div>
        </div>
      );
    };

    const MonthlyIncomeChart = ({ payments }) => {
      const monthlyData = [];
      const now = new Date();
      for (let i = 5; i >= 0; i--) {
        const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
        const monthName = date.toLocaleString('en-US', { month: 'short' });
        const monthPayments = payments.filter(p => {
          const pDate = new Date(p.date);
          return pDate.getMonth() === date.getMonth() && pDate.getFullYear() === date.getFullYear();
        });
        const income = monthPayments.reduce((sum, p) => sum + parseFloat(p.amount || 0), 0);
        monthlyData.push({ month: monthName, income, isCurrentMonth: i === 0 });
      }
      const maxIncome = Math.max(...monthlyData.map(m => m.income), 1);
      return (
        <div className="flex items-end justify-between gap-3 h-48">
          {monthlyData.map((month, i) => (
            <div key={i} className="flex-1 flex flex-col items-center gap-2">
              <span className="text-emerald-400 text-sm font-medium">‚Ç¨{month.income >= 1000 ? (month.income/1000).toFixed(1)+'k' : month.income}</span>
              <div className="w-full bg-gray-700/50 rounded-lg relative overflow-hidden" style={{ height: '120px' }}>
                <div className={`absolute bottom-0 w-full rounded-lg transition-all duration-700 ${month.isCurrentMonth ? 'bg-gradient-to-t from-cyan-500 to-cyan-400' : 'bg-gradient-to-t from-emerald-600 to-emerald-400'}`} style={{ height: `${(month.income / maxIncome) * 100}%` }} />
              </div>
              <span className={`text-xs font-medium ${month.isCurrentMonth ? 'text-cyan-400' : 'text-gray-400'}`}>{month.month}</span>
            </div>
          ))}
        </div>
      );
    };

    const YearlyIncomePattern = ({ payments }) => {
      const now = new Date();
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const yearlyData = months.map((month, index) => {
        const monthPayments = payments.filter(p => { const pDate = new Date(p.date); return pDate.getMonth() === index && pDate.getFullYear() === now.getFullYear(); });
        return { month, income: monthPayments.reduce((sum, p) => sum + parseFloat(p.amount || 0), 0) };
      });
      const totalIncome = yearlyData.reduce((sum, m) => sum + m.income, 0);
      const avgIncome = yearlyData.filter(m => m.income > 0).length > 0 ? totalIncome / yearlyData.filter(m => m.income > 0).length : 0;
      const getStrength = (income) => {
        if (income === 0) return { color: 'bg-gray-700', textColor: 'text-gray-500' };
        if (income >= avgIncome * 1.15) return { color: 'bg-emerald-500/30 border border-emerald-500/50', textColor: 'text-emerald-400' };
        if (income <= avgIncome * 0.85) return { color: 'bg-red-500/20 border border-red-500/50', textColor: 'text-red-400' };
        return { color: 'bg-cyan-500/20 border border-cyan-500/50', textColor: 'text-cyan-400' };
      };
      return (
        <div>
          <div className="grid grid-cols-4 sm:grid-cols-6 lg:grid-cols-12 gap-2 mb-6">
            {yearlyData.map((m, i) => {
              const strength = getStrength(m.income);
              return (
                <div key={i} className={`rounded-xl p-3 text-center ${strength.color} ${i === now.getMonth() ? 'ring-2 ring-cyan-400' : ''}`}>
                  <div className="text-xs text-gray-400 mb-1">{m.month}</div>
                  <div className={`text-sm font-bold ${strength.textColor}`}>{m.income > 0 ? `‚Ç¨${(m.income/1000).toFixed(1)}k` : '-'}</div>
                </div>
              );
            })}
          </div>
          <div className="flex flex-wrap gap-4 text-sm">
            <div className="flex items-center gap-2"><div className="w-3 h-3 rounded bg-emerald-500/50"></div><span className="text-gray-400">Strong</span></div>
            <div className="flex items-center gap-2"><div className="w-3 h-3 rounded bg-cyan-500/50"></div><span className="text-gray-400">Average</span></div>
            <div className="flex items-center gap-2"><div className="w-3 h-3 rounded bg-red-500/30"></div><span className="text-gray-400">Weak</span></div>
          </div>
        </div>
      );
    };

    const SessionsPerMonthChart = ({ payments }) => {
      const now = new Date();
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const sessionData = months.map((month, index) => {
        const monthPayments = payments.filter(p => { const pDate = new Date(p.date); return pDate.getMonth() === index && pDate.getFullYear() === now.getFullYear(); });
        return { month, sessions: monthPayments.reduce((sum, p) => sum + (p.sessions_completed || 0), 0), isCurrentMonth: index === now.getMonth() };
      });
      const maxSessions = Math.max(...sessionData.map(m => m.sessions), 1);
      const totalSessions = sessionData.reduce((sum, m) => sum + m.sessions, 0);
      const avgSessions = sessionData.filter(m => m.sessions > 0).length > 0 ? Math.round(totalSessions / sessionData.filter(m => m.sessions > 0).length) : 0;
      return (
        <div>
          <div className="flex items-end justify-between gap-1 h-32 mb-4">
            {sessionData.map((m, i) => (
              <div key={i} className="flex-1 flex flex-col items-center gap-1">
                <span className={`text-xs font-medium ${m.isCurrentMonth ? 'text-cyan-400' : 'text-purple-400'}`}>{m.sessions || ''}</span>
                <div className="w-full bg-gray-700/50 rounded relative overflow-hidden" style={{ height: '80px' }}>
                  <div className={`absolute bottom-0 w-full rounded ${m.isCurrentMonth ? 'bg-gradient-to-t from-cyan-500 to-cyan-400' : 'bg-gradient-to-t from-purple-600 to-purple-400'}`} style={{ height: `${(m.sessions / maxSessions) * 100}%` }} />
                </div>
                <span className={`text-xs ${m.isCurrentMonth ? 'text-cyan-400' : 'text-gray-500'}`}>{m.month.slice(0,1)}</span>
              </div>
            ))}
          </div>
          <div className="flex justify-between text-sm pt-4 border-t border-gray-700">
            <span className="text-gray-400">Total: <span className="text-white font-semibold">{totalSessions}</span></span>
            <span className="text-gray-400">Avg: <span className="text-purple-400 font-semibold">{avgSessions}/mo</span></span>
          </div>
        </div>
      );
    };

    // Auth Screen - Shows SIGN UP by default if coming from payment
    const AuthScreen = ({ onLogin }) => {
      const [isLogin, setIsLogin] = useState(!justPaid); // Show Sign Up if just paid
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);
        try {
          const { data, error } = isLogin 
            ? await supabaseClient.auth.signInWithPassword({ email, password })
            : await supabaseClient.auth.signUp({ email, password });
          if (error) throw error;
          if (data.user) onLogin(data.user);
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };
      
      return (
        <div className="min-h-screen bg-gray-900 flex items-center justify-center p-4">
          <div className="fixed inset-0 bg-gradient-to-br from-gray-900 via-gray-900 to-gray-800 pointer-events-none" />
          <div className="fixed top-0 right-0 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl pointer-events-none" />
          <div className="fixed bottom-0 left-0 w-96 h-96 bg-emerald-500/10 rounded-full blur-3xl pointer-events-none" />
          <div className="relative bg-gray-800 border border-gray-700 rounded-2xl p-8 w-full max-w-md">
            <div className="text-center mb-8">
              <h1 className="text-3xl font-bold text-cyan-400">PT LOG</h1>
              <p className="text-gray-400 mt-2">Revenue Compass for Coaches</p>
            </div>
            
            {/* Welcome message for users coming from payment */}
            {justPaid && !isLogin && (
              <div className="bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4 mb-6">
                <p className="text-emerald-400 font-medium text-center">üéâ Payment successful!</p>
                <p className="text-gray-400 text-sm text-center mt-1">Create your account using the <strong>same email</strong> you used for payment.</p>
              </div>
            )}
            
            <form onSubmit={handleSubmit} className="space-y-4">
              <div>
                <label className="block text-gray-400 text-sm mb-2">Email</label>
                <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full bg-gray-700 border border-gray-600 rounded-xl px-4 py-3 text-white focus:border-cyan-500 focus:outline-none" placeholder="Use the same email from payment" required />
              </div>
              <div>
                <label className="block text-gray-400 text-sm mb-2">Password</label>
                <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full bg-gray-700 border border-gray-600 rounded-xl px-4 py-3 text-white focus:border-cyan-500 focus:outline-none" placeholder="Min 6 characters" required minLength={6} />
              </div>
              {error && <div className="bg-red-500/10 border border-red-500/30 rounded-xl p-3 text-red-400 text-sm">{error}</div>}
              <button type="submit" disabled={loading} className="w-full py-3 bg-cyan-500 hover:bg-cyan-400 disabled:bg-gray-600 text-gray-900 font-semibold rounded-xl">{loading ? 'Loading...' : isLogin ? 'Sign In' : 'Create Account'}</button>
            </form>
            <p className="text-center mt-6 text-gray-400">{isLogin ? "Don't have an account?" : "Already have an account?"} <button onClick={() => setIsLogin(!isLogin)} className="text-cyan-400 hover:text-cyan-300">{isLogin ? 'Sign Up' : 'Sign In'}</button></p>
          </div>
        </div>
      );
    };

    const App = () => {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);
      const [subscription, setSubscription] = useState(null);
      const [checkingSub, setCheckingSub] = useState(false);
      const [clients, setClients] = useState([]);
      const [payments, setPayments] = useState([]);
      const [targets, setTargets] = useState([]);
      const [showNewClientModal, setShowNewClientModal] = useState(false);
      const [showPaymentModal, setShowPaymentModal] = useState(false);
      const [showTargetsModal, setShowTargetsModal] = useState(false);
      const [newClient, setNewClient] = useState({ name: '', email: '', phone: '' });
      const [newPayment, setNewPayment] = useState({ client_id: '', type: 'Pack', amount: '', sessions: '', duration: 60, date: new Date().toISOString().split('T')[0] });
      const [editTargets, setEditTargets] = useState({ revenueGoal: 5000, clientsGoal: 15 });

      useEffect(() => {
        supabaseClient.auth.getSession().then(({ data: { session } }) => { setUser(session?.user ?? null); setLoading(false); });
        const { data: { subscription } } = supabaseClient.auth.onAuthStateChange((_event, session) => { setUser(session?.user ?? null); });
        return () => subscription.unsubscribe();
      }, []);

      useEffect(() => { if (user) checkSubscription(); }, [user]);

      const checkSubscription = async () => {
        setCheckingSub(true);
        try {
          const { data } = await supabaseClient.from('subscriptions').select('*').eq('email', user.email).eq('status', 'active').single();
          if (data) {
            if (data.plan_type !== 'lifetime' && data.expires_at && new Date(data.expires_at) < new Date()) {
              setSubscription(null);
            } else {
              setSubscription(data);
              fetchAllData();
            }
          } else { setSubscription(null); }
        } catch { setSubscription(null); }
        finally { setCheckingSub(false); }
      };

      const fetchAllData = async () => {
        const [c, p, t] = await Promise.all([
          supabaseClient.from('clients').select('*').order('created_at', { ascending: false }),
          supabaseClient.from('payments').select('*, clients(name)').order('date', { ascending: false }),
          supabaseClient.from('targets').select('*')
        ]);
        setClients(c.data || []);
        setPayments(p.data || []);
        if (t.data?.length === 0) {
          const def = [{ target_name: 'Monthly Revenue', goal: 5000, user_id: user.id }, { target_name: 'Active Clients', goal: 15, user_id: user.id }];
          await supabaseClient.from('targets').insert(def);
          setTargets(def);
        } else { setTargets(t.data || []); }
      };

      const handleAddClient = async () => {
        if (!newClient.name.trim()) return;
        await supabaseClient.from('clients').insert([{ ...newClient, user_id: user.id, status: 'Active' }]);
        setNewClient({ name: '', email: '', phone: '' }); setShowNewClientModal(false); fetchAllData();
      };

      const handleAddPayment = async () => {
        if (!newPayment.client_id || !newPayment.amount || !newPayment.sessions) return;
        await supabaseClient.from('payments').insert([{ 
          client_id: newPayment.client_id, 
          type: newPayment.type, 
          amount: parseFloat(newPayment.amount), 
          sessions: parseInt(newPayment.sessions), 
          sessions_completed: 0, 
          duration: newPayment.duration || 60,
          user_id: user.id, 
          date: newPayment.date 
        }]);
        setNewPayment({ client_id: '', type: 'Pack', amount: '', sessions: '', duration: 60, date: new Date().toISOString().split('T')[0] }); 
        setShowPaymentModal(false); 
        fetchAllData();
      };

      const updateSession = async (id, curr, total, action) => {
        const newVal = action === 'add' ? Math.min(curr + 1, total) : Math.max(curr - 1, 0);
        if (newVal !== curr) { 
          // Optimistic update - update local state first
          setPayments(prev => prev.map(p => p.id === id ? {...p, sessions_completed: newVal} : p));
          // Then update database
          await supabaseClient.from('payments').update({ sessions_completed: newVal }).eq('id', id);
        }
      };

      const handleLogout = async () => { await supabaseClient.auth.signOut(); setUser(null); setSubscription(null); };

      const handleUpdateTargets = async () => {
        const rev = targets.find(t => t.target_name === 'Monthly Revenue');
        const cli = targets.find(t => t.target_name === 'Active Clients');
        if (rev) await supabaseClient.from('targets').update({ goal: editTargets.revenueGoal }).eq('id', rev.id);
        if (cli) await supabaseClient.from('targets').update({ goal: editTargets.clientsGoal }).eq('id', cli.id);
        setShowTargetsModal(false); fetchAllData();
      };

      const now = new Date();
      const thisMonthPayments = payments.filter(p => { const d = new Date(p.date); return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear(); });
      const thisMonthRevenue = thisMonthPayments.reduce((s, p) => s + parseFloat(p.amount || 0), 0);
      const lastMonthPayments = payments.filter(p => { const d = new Date(p.date); const lm = new Date(now.getFullYear(), now.getMonth() - 1, 1); return d.getMonth() === lm.getMonth() && d.getFullYear() === lm.getFullYear(); });
      const lastMonthRevenue = lastMonthPayments.reduce((s, p) => s + parseFloat(p.amount || 0), 0);
      const totalRevenue = payments.reduce((s, p) => s + parseFloat(p.amount || 0), 0);
      const revenueTrend = lastMonthRevenue > 0 ? Math.round(((thisMonthRevenue - lastMonthRevenue) / lastMonthRevenue) * 100) : null;
      const activeClients = clients.filter(c => c.status === 'Active').length;
      const renewalsSoon = payments.filter(p => (p.sessions - p.sessions_completed) <= 2 && (p.sessions - p.sessions_completed) > 0);
      const revenueTarget = targets.find(t => t.target_name === 'Monthly Revenue');
      const clientsTarget = targets.find(t => t.target_name === 'Active Clients');

      if (loading) return <div className="min-h-screen bg-gray-900 flex items-center justify-center"><div className="text-cyan-400 text-xl">Loading...</div></div>;
      if (!user) return <AuthScreen onLogin={setUser} />;
      if (checkingSub) return <div className="min-h-screen bg-gray-900 flex items-center justify-center"><div className="text-cyan-400 text-xl">Checking subscription...</div></div>;
      if (!subscription) return <Paywall email={user.email} onLogout={handleLogout} onRetry={checkSubscription} />;

      return (
        <div className="min-h-screen bg-gray-900 text-white">
          <div className="fixed inset-0 bg-gradient-to-br from-gray-900 via-gray-900 to-gray-800 pointer-events-none" />
          <div className="fixed top-0 right-0 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl pointer-events-none" />
          <div className="fixed bottom-0 left-0 w-96 h-96 bg-emerald-500/10 rounded-full blur-3xl pointer-events-none" />

          {showNewClientModal && <Modal title="New Client" onClose={() => setShowNewClientModal(false)}>
            <div className="space-y-4">
              <div>
                <label className="block text-gray-400 text-sm mb-2">Client Name *</label>
                <input type="text" value={newClient.name} onChange={(e) => setNewClient({...newClient, name: e.target.value})} className="w-full bg-gray-700 border border-gray-600 rounded-xl px-4 py-3 text-white focus:border-cyan-500 focus:outline-none" placeholder="Enter client name" autoFocus />
              </div>
              <div className="flex gap-3 pt-2">
                <button onClick={() => setShowNewClientModal(false)} className="flex-1 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-medium">Cancel</button>
                <button onClick={handleAddClient} disabled={!newClient.name.trim()} className="flex-1 py-3 bg-cyan-500 hover:bg-cyan-400 disabled:bg-gray-600 text-gray-900 rounded-xl font-medium">Add Client</button>
              </div>
            </div>
          </Modal>}

          {showPaymentModal && <Modal title="Add Payment" onClose={() => setShowPaymentModal(false)}>
            <div className="space-y-4">
              {/* Client Selection */}
              <div>
                <label className="block text-gray-400 text-sm mb-2">Client *</label>
                <select value={newPayment.client_id} onChange={(e) => setNewPayment({...newPayment, client_id: e.target.value})} className="w-full bg-gray-700 border border-gray-600 rounded-xl px-4 py-3 text-white focus:border-cyan-500 focus:outline-none">
                  <option value="">Select client...</option>
                  {clients.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                </select>
              </div>
              
              {/* Payment Type */}
              <div>
                <label className="block text-gray-400 text-sm mb-2">Type</label>
                <div className="grid grid-cols-3 gap-2">
                  {['Single','Pack','Monthly'].map(t => (
                    <button key={t} onClick={() => setNewPayment({...newPayment, type: t})} className={`p-3 rounded-xl border text-sm font-medium transition-all ${newPayment.type === t ? 'bg-cyan-500/20 border-cyan-500 text-cyan-400' : 'bg-gray-700/50 border-gray-600 text-gray-300 hover:border-gray-500'}`}>{t}</button>
                  ))}
                </div>
              </div>
              
              {/* Session Duration */}
              <div>
                <label className="block text-gray-400 text-sm mb-2">Session Length</label>
                <div className="grid grid-cols-4 gap-2">
                  {[30, 45, 60, 90].map(d => (
                    <button key={d} onClick={() => setNewPayment({...newPayment, duration: d})} className={`p-3 rounded-xl border text-sm font-medium transition-all ${newPayment.duration === d ? 'bg-purple-500/20 border-purple-500 text-purple-400' : 'bg-gray-700/50 border-gray-600 text-gray-300 hover:border-gray-500'}`}>{d}min</button>
                  ))}
                </div>
              </div>
              
              {/* Amount and Sessions */}
              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block text-gray-400 text-sm mb-2">Amount (‚Ç¨) *</label>
                  <input type="number" value={newPayment.amount} onChange={(e) => setNewPayment({...newPayment, amount: e.target.value})} className="w-full bg-gray-700 border border-gray-600 rounded-xl px-4 py-3 text-white focus:border-cyan-500 focus:outline-none" placeholder="0.00" />
                </div>
                <div>
                  <label className="block text-gray-400 text-sm mb-2">Sessions *</label>
                  <input type="number" value={newPayment.sessions} onChange={(e) => setNewPayment({...newPayment, sessions: e.target.value})} className="w-full bg-gray-700 border border-gray-600 rounded-xl px-4 py-3 text-white focus:border-cyan-500 focus:outline-none" placeholder="0" />
                </div>
              </div>
              
              {/* Date */}
              <div>
                <label className="block text-gray-400 text-sm mb-2">Payment Date</label>
                <input type="date" value={newPayment.date} onChange={(e) => setNewPayment({...newPayment, date: e.target.value})} className="w-full bg-gray-700 border border-gray-600 rounded-xl px-4 py-3 text-white focus:border-cyan-500 focus:outline-none appearance-none" style={{minHeight: '50px'}} />
              </div>
              
              {/* Price Summary */}
              {newPayment.amount && newPayment.sessions && (
                <div className="bg-gray-700/50 rounded-xl p-4">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-gray-400 text-sm">Per session:</span>
                    <span className="text-xl font-bold text-yellow-400">‚Ç¨{(parseFloat(newPayment.amount)/parseInt(newPayment.sessions)).toFixed(2)}</span>
                  </div>
                  {newPayment.duration && (
                    <div className="flex justify-between items-center">
                      <span className="text-gray-400 text-sm">Per hour:</span>
                      <span className="text-lg font-semibold text-emerald-400">‚Ç¨{((parseFloat(newPayment.amount)/parseInt(newPayment.sessions)) * (60/newPayment.duration)).toFixed(2)}</span>
                    </div>
                  )}
                </div>
              )}
              
              {/* Buttons */}
              <div className="flex gap-3 pt-2">
                <button onClick={() => setShowPaymentModal(false)} className="flex-1 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-medium">Cancel</button>
                <button onClick={handleAddPayment} disabled={!newPayment.client_id || !newPayment.amount || !newPayment.sessions} className="flex-1 py-3 bg-cyan-500 hover:bg-cyan-400 disabled:bg-gray-600 text-gray-900 rounded-xl font-medium">Add Payment</button>
              </div>
            </div>
          </Modal>}

          {showTargetsModal && <Modal title="Edit Targets" onClose={() => setShowTargetsModal(false)}>
            <div className="space-y-4">
              <div><label className="block text-gray-400 text-sm mb-2">Monthly Revenue Goal (‚Ç¨)</label><input type="number" value={editTargets.revenueGoal} onChange={(e) => setEditTargets({...editTargets, revenueGoal: parseInt(e.target.value)||0})} className="w-full bg-gray-700 border border-gray-600 rounded-xl px-4 py-3 text-white focus:border-cyan-500 focus:outline-none" /></div>
              <div><label className="block text-gray-400 text-sm mb-2">Active Clients Goal</label><input type="number" value={editTargets.clientsGoal} onChange={(e) => setEditTargets({...editTargets, clientsGoal: parseInt(e.target.value)||0})} className="w-full bg-gray-700 border border-gray-600 rounded-xl px-4 py-3 text-white focus:border-cyan-500 focus:outline-none" /></div>
              <div className="flex gap-3 pt-4"><button onClick={() => setShowTargetsModal(false)} className="flex-1 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-medium">Cancel</button><button onClick={handleUpdateTargets} className="flex-1 py-3 bg-cyan-500 hover:bg-cyan-400 text-gray-900 rounded-xl font-medium">Save</button></div>
            </div>
          </Modal>}

          <div className="relative">
            <header className="border-b border-gray-800 bg-gray-900/80 backdrop-blur-xl sticky top-0 z-10">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 py-5">
                <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                  <div><h1 className="text-2xl font-bold text-cyan-400">PT LOG</h1><p className="text-gray-500 text-sm">Revenue Compass for Coaches</p></div>
                  <div className="flex items-center gap-2 flex-wrap">
                    <span className="px-3 py-1 bg-emerald-500/20 text-emerald-400 text-xs rounded-full font-medium">{subscription.plan_type.toUpperCase()}</span>
                    <button onClick={() => setShowNewClientModal(true)} className="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white font-medium rounded-xl text-sm">+ Client</button>
                    <button onClick={() => setShowPaymentModal(true)} className="px-4 py-2 bg-cyan-500 hover:bg-cyan-400 text-gray-900 font-medium rounded-xl text-sm">+ Payment</button>
                    <button onClick={handleLogout} className="px-4 py-2 text-gray-400 hover:text-white text-sm">Logout</button>
                  </div>
                </div>
              </div>
            </header>

            <main className="max-w-7xl mx-auto px-4 sm:px-6 py-8">
              <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <MetricCard icon="üí∞" value={`‚Ç¨${thisMonthRevenue.toLocaleString()}`} label="This Month" trend={revenueTrend} color="bg-emerald-500/20" />
                <MetricCard icon="üìà" value={`‚Ç¨${totalRevenue.toLocaleString()}`} label="Total Revenue" color="bg-cyan-500/20" />
                <MetricCard icon="üë•" value={activeClients} label="Active Clients" color="bg-purple-500/20" />
                <MetricCard icon="‚ö†Ô∏è" value={renewalsSoon.length} label="Renewals Soon" color="bg-orange-500/20" />
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div className="lg:col-span-2 bg-gray-800/50 backdrop-blur border border-gray-700/50 rounded-2xl p-6">
                  <h3 className="text-lg font-semibold mb-6">üìä Monthly Income</h3>
                  {payments.length === 0 ? <p className="text-gray-500 text-center py-12">Add payments to see chart</p> : <MonthlyIncomeChart payments={payments} />}
                </div>
                <div className="bg-gray-800/50 backdrop-blur border border-gray-700/50 rounded-2xl p-6">
                  <div className="flex justify-between mb-6"><h3 className="text-lg font-semibold">üéØ Targets</h3><button onClick={() => { setEditTargets({ revenueGoal: revenueTarget?.goal||5000, clientsGoal: clientsTarget?.goal||15 }); setShowTargetsModal(true); }} className="text-gray-400 hover:text-white text-sm">Edit</button></div>
                  <ProgressBar current={thisMonthRevenue} goal={revenueTarget?.goal||5000} label="Revenue (‚Ç¨)" color="from-emerald-500 to-emerald-400" />
                  <ProgressBar current={activeClients} goal={clientsTarget?.goal||15} label="Clients" color="from-purple-500 to-purple-400" />
                  {renewalsSoon.length > 0 && <div className="mt-6 pt-4 border-t border-gray-700"><h4 className="text-sm text-gray-400 mb-3">‚ö†Ô∏è Renewals Soon</h4><div className="space-y-2">{renewalsSoon.slice(0,3).map(p => <div key={p.id} className="flex justify-between text-sm bg-orange-500/10 border border-orange-500/30 rounded-lg px-3 py-2"><span className="text-gray-300">{p.clients?.name}</span><span className="text-orange-400 font-medium">{p.sessions-p.sessions_completed} left</span></div>)}</div></div>}
                </div>
              </div>

              <div className="bg-gray-800/50 backdrop-blur border border-gray-700/50 rounded-2xl p-6 mb-8">
                <h3 className="text-lg font-semibold mb-6">üíé Revenue Per Client</h3>
                {clients.length === 0 ? <p className="text-gray-500 text-center py-8">No clients yet</p> : <div className="space-y-3">{clients.map(c => ({...c, revenue: payments.filter(p => p.client_id === c.id).reduce((s,p) => s+parseFloat(p.amount||0),0)})).sort((a,b) => b.revenue-a.revenue).map((c,i) => {const max = Math.max(...clients.map(cl => payments.filter(p => p.client_id===cl.id).reduce((s,p) => s+parseFloat(p.amount||0),0)),1); const colors = ['from-cyan-500 to-cyan-400','from-purple-500 to-purple-400','from-emerald-500 to-emerald-400','from-orange-500 to-orange-400']; return <div key={c.id}><div className="flex justify-between mb-1"><div className="flex items-center gap-2"><div className={`w-8 h-8 rounded-full bg-gradient-to-br ${colors[i%4]} flex items-center justify-center text-white text-xs font-semibold`}>{c.name?.split(' ').map(n=>n[0]).join('')}</div><span className="text-gray-300">{c.name}</span></div><span className="text-white font-semibold">‚Ç¨{c.revenue.toLocaleString()}</span></div><div className="h-2 bg-gray-700 rounded-full overflow-hidden"><div className={`h-full rounded-full bg-gradient-to-r ${colors[i%4]}`} style={{width:`${(c.revenue/max)*100}%`}}/></div></div>})}</div>}
              </div>

              <div className="bg-gray-800/50 backdrop-blur border border-emerald-500/30 rounded-2xl p-6 mb-8">
                <h3 className="text-lg font-semibold mb-6">üìÖ Yearly Pattern</h3>
                <YearlyIncomePattern payments={payments} />
              </div>

              <div className="bg-gray-800/50 backdrop-blur border border-cyan-500/30 rounded-2xl p-6 mb-8">
                <h3 className="text-lg font-semibold mb-6">‚úÖ Session Tracker</h3>
                {payments.length === 0 ? <p className="text-gray-500 text-center py-8">No payments yet</p> : <div>
                  <div className="grid grid-cols-3 gap-4 mb-6">
                    <div className="bg-gray-700/30 rounded-xl p-4 text-center"><div className="text-2xl font-bold text-emerald-400">{payments.reduce((s,p)=>s+p.sessions_completed,0)}</div><div className="text-gray-400 text-sm">Done</div></div>
                    <div className="bg-gray-700/30 rounded-xl p-4 text-center"><div className="text-2xl font-bold text-orange-400">{payments.reduce((s,p)=>s+(p.sessions-p.sessions_completed),0)}</div><div className="text-gray-400 text-sm">Left</div></div>
                    <div className="bg-gray-700/30 rounded-xl p-4 text-center"><div className="text-2xl font-bold text-cyan-400">{payments.reduce((s,p)=>s+p.sessions,0)}</div><div className="text-gray-400 text-sm">Total</div></div>
                  </div>
                  <div className="space-y-4">{payments.filter(p => p.sessions > 0 && p.sessions_completed < p.sessions).map(p => <div key={p.id} className="bg-gray-800/30 rounded-xl border border-gray-700/30 p-4">
                    <div className="flex justify-between mb-3">
                      <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white font-semibold text-sm flex-shrink-0">{p.clients?.name?.split(' ').map(n=>n[0]).join('')||'?'}</div>
                        <div>
                          <div className="text-white font-medium">{p.clients?.name||'?'}</div>
                          <div className="text-xs text-gray-400">{p.type} ‚Ä¢ ‚Ç¨{p.amount}{p.duration ? ` ‚Ä¢ ${p.duration}min` : ''}</div>
                        </div>
                      </div>
                      <div className="text-right flex-shrink-0">
                        <div className="text-white font-semibold">{p.sessions_completed}/{p.sessions}</div>
                        <div className={`text-xs ${p.sessions-p.sessions_completed<=2 && p.sessions-p.sessions_completed>0 ? 'text-orange-400':'text-gray-400'}`}>{p.sessions-p.sessions_completed} left</div>
                      </div>
                    </div>
                    <div className="flex items-center gap-2">
                      <button onClick={()=>updateSession(p.id,p.sessions_completed,p.sessions,'deduct')} disabled={p.sessions_completed===0} className={`w-9 h-9 rounded-lg flex items-center justify-center text-lg font-bold flex-shrink-0 ${p.sessions_completed>0 ? 'bg-red-500/20 border border-red-500/50 text-red-400 hover:bg-red-500/30':'bg-gray-700/30 border border-gray-600/30 text-gray-600 cursor-not-allowed'}`}>‚àí</button>
                      <div className="flex-1 flex items-center justify-end gap-1 overflow-hidden">
                        <div className="flex gap-1 flex-row-reverse overflow-x-auto scrollbar-hide py-1" style={{direction: 'rtl'}}>
                          {Array.from({length:p.sessions},(_,i)=> p.sessions - 1 - i).map(i => (
                            <div key={i} style={{direction: 'ltr'}} className={`w-7 h-7 rounded-md flex items-center justify-center text-xs font-medium flex-shrink-0 ${i<p.sessions_completed ? 'bg-emerald-500/20 border border-emerald-500/50 text-emerald-400':'bg-gray-700/30 border border-gray-600/30 text-gray-500'}`}>{i<p.sessions_completed?'‚úì':i+1}</div>
                          ))}
                        </div>
                      </div>
                      <button onClick={()=>updateSession(p.id,p.sessions_completed,p.sessions,'add')} disabled={p.sessions_completed>=p.sessions} className={`w-9 h-9 rounded-lg flex items-center justify-center text-lg font-bold flex-shrink-0 ${p.sessions_completed<p.sessions ? 'bg-emerald-500/20 border border-emerald-500/50 text-emerald-400 hover:bg-emerald-500/30':'bg-gray-700/30 border border-gray-600/30 text-gray-600 cursor-not-allowed'}`}>+</button>
                    </div>
                  </div>)}</div>
                </div>}
              </div>

              <div className="bg-gray-800/50 backdrop-blur border border-purple-500/30 rounded-2xl p-6 mb-8">
                <h3 className="text-lg font-semibold mb-6">üèãÔ∏è Sessions Per Month</h3>
                <SessionsPerMonthChart payments={payments} />
              </div>

              <div className="bg-gray-800/50 backdrop-blur border border-yellow-500/30 rounded-2xl p-6">
                <h3 className="text-lg font-semibold mb-6">üíµ Price Per Session</h3>
                {payments.length === 0 ? <p className="text-gray-500 text-center py-8">No data</p> : <div>
                  {/* Summary Cards */}
                  <div className="grid grid-cols-2 gap-4 mb-6">
                    <div className="bg-gradient-to-r from-yellow-500/10 to-amber-500/10 border border-yellow-500/30 rounded-xl p-4">
                      <div className="text-gray-400 text-sm mb-1">Avg Per Session</div>
                      <div className="text-2xl font-bold text-yellow-400">‚Ç¨{(payments.reduce((s,p)=>s+parseFloat(p.amount||0),0)/payments.reduce((s,p)=>s+(p.sessions||0),0)||0).toFixed(2)}</div>
                    </div>
                    <div className="bg-gradient-to-r from-emerald-500/10 to-green-500/10 border border-emerald-500/30 rounded-xl p-4">
                      <div className="text-gray-400 text-sm mb-1">Avg Per Hour</div>
                      <div className="text-2xl font-bold text-emerald-400">‚Ç¨{(payments.reduce((s,p) => {
                        const pps = parseFloat(p.amount||0) / (p.sessions||1);
                        const pph = pps * (60 / (p.duration || 60));
                        return s + (pph * (p.sessions||0));
                      }, 0) / payments.reduce((s,p)=>s+(p.sessions||0),0) || 0).toFixed(2)}</div>
                    </div>
                  </div>
                  
                  {/* By Duration Brackets */}
                  {[30, 45, 60, 90].map(dur => {
                    const durPayments = payments.filter(p => (p.duration || 60) === dur);
                    if (durPayments.length === 0) return null;
                    const totalAmount = durPayments.reduce((s,p) => s + parseFloat(p.amount||0), 0);
                    const totalSessions = durPayments.reduce((s,p) => s + (p.sessions||0), 0);
                    const avgPps = totalSessions > 0 ? totalAmount / totalSessions : 0;
                    const avgPph = avgPps * (60 / dur);
                    return (
                      <div key={dur} className="mb-4 last:mb-0">
                        <div className="flex items-center justify-between mb-2">
                          <span className="text-sm font-medium text-purple-400">{dur} min sessions</span>
                          <div className="flex gap-4 text-sm">
                            <span className="text-gray-400">‚Ç¨{avgPps.toFixed(2)}/sess</span>
                            <span className="text-emerald-400 font-medium">‚Ç¨{avgPph.toFixed(2)}/hr</span>
                          </div>
                        </div>
                        <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
                          <div className="h-full rounded-full bg-gradient-to-r from-purple-500 to-purple-400" style={{width: `${Math.min((totalSessions / payments.reduce((s,p)=>s+(p.sessions||0),0)) * 100, 100)}%`}} />
                        </div>
                        <div className="text-xs text-gray-500 mt-1">{totalSessions} sessions ‚Ä¢ ‚Ç¨{totalAmount.toFixed(0)} total</div>
                      </div>
                    );
                  })}
                  
                  {/* Per Client */}
                  <div className="mt-6 pt-4 border-t border-gray-700">
                    <h4 className="text-sm text-gray-400 mb-3">By Client</h4>
                    <div className="space-y-3">{clients.map(c => {const cp = payments.filter(p=>p.client_id===c.id); const ta = cp.reduce((s,p)=>s+parseFloat(p.amount||0),0); const ts = cp.reduce((s,p)=>s+(p.sessions||0),0); const avgDur = ts > 0 ? cp.reduce((s,p) => s + ((p.duration||60) * (p.sessions||0)), 0) / ts : 60; return {...c, pps: ts>0?ta/ts:0, pph: ts>0?(ta/ts)*(60/avgDur):0, ts, avgDur};}).filter(c=>c.ts>0).sort((a,b)=>b.pph-a.pph).map((c,i) => {const max = Math.max(...clients.map(cl=>{const cp=payments.filter(p=>p.client_id===cl.id);const ta=cp.reduce((s,p)=>s+parseFloat(p.amount||0),0);const ts=cp.reduce((s,p)=>s+(p.sessions||0),0);const avgDur = ts > 0 ? cp.reduce((s,p) => s + ((p.duration||60) * (p.sessions||0)), 0) / ts : 60;return ts>0?(ta/ts)*(60/avgDur):0;}),1); const colors = ['from-yellow-500 to-amber-500','from-orange-500 to-red-500','from-cyan-500 to-blue-500','from-emerald-500 to-green-500']; return <div key={c.id}><div className="flex justify-between mb-1"><div className="flex items-center gap-2"><div className={`w-6 h-6 rounded-full bg-gradient-to-br ${colors[i%4]} flex items-center justify-center text-white text-xs font-semibold`}>{c.name?.split(' ').map(n=>n[0]).join('')}</div><span className="text-gray-300 text-sm">{c.name}</span><span className="text-gray-500 text-xs">({c.ts} √ó {Math.round(c.avgDur)}min)</span></div><div className="text-right"><span className="text-yellow-400 font-semibold text-sm">‚Ç¨{c.pps.toFixed(2)}</span><span className="text-gray-500 mx-1">‚Ä¢</span><span className="text-emerald-400 text-sm">‚Ç¨{c.pph.toFixed(2)}/hr</span></div></div><div className="h-2 bg-gray-700 rounded-full overflow-hidden"><div className={`h-full rounded-full bg-gradient-to-r ${colors[i%4]}`} style={{width:`${(c.pph/max)*100}%`}}/></div></div>})}</div>
                  </div>
                </div>}
              </div>
            </main>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
